var express = require('express');var router = express.Router();var c=require('crypto');var con=require('../../modules/index/mysql');var ejs=require('ejs');/* GET home page. */router.get('/', function(req, res, next) {    //判断权限    if(req.session.ids){        res.redirect('/');    }    //数据处理，以及网页请求    res.render('./index/login', { });});//登录验证router.post('/',function (req,res,next) {    var zhang=req.body.zhang;    var mi=req.body.mi;    var md5=c.createHash('md5');    md5.update(mi);    var sign = md5.digest('hex');    con.query('select * from wuser where zhang=?',[zhang],function (err,rul,files) {        if (err)throw err;        if (rul.length>0){            con.query('select * from wuser where mi=? and zhang=?',[sign,zhang],function (err,rul,files) {                if (err)throw err;                if (rul.length>0){                    //成功                    req.session.ids=rul[0].id;                    req.session.name=rul[0].name;                    req.session.img=rul[0].imgurl;                    console.dir(req.session.img);                    res.redirect('/index');                    res.end('1');                }else{                    //失败                    res.redirect('/login');                    res.end('0');                }            });        }else {            res.redirect('/login');            res.end('0');        }    });});module.exports = router;