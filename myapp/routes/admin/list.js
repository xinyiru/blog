var express = require('express');var router = express.Router();var con=require('../../modules/admin/mysql');var ejs=require('ejs');//请求页面router.get('/', function(req, res, next) {    con.query('select * from context',function (err,rul,fiels) {        if (err)throw err;        if (rul.length){            //数据处理，以及网页请求            res.render('./admin/list', { data : rul });        }else{             //数据处理，以及网页请求            res.render('./admin/list', { data : rul });        }    });});//单页删除router.get('/del/:id',function (req,res,next) {    var id=req.params.id;    con.query('delete from context where id=?',[id],function (err,rul,fiels) {        if(err)throw err;        if (rul.affectedRows>0){            res.redirect('/hlist');        }else {            res.redirect('/hlist');        }    });});//批量删除router.get('/pldel/:ids',function (req,res,next) {    var arr=req.params.ids;    var newarr=arr.split(',');    // for(var i=0;i<newarr.length;i++){        con.query('delete from context where id=?',[newarr[0]],function (err,rul,fiels) {            if(err)throw err;            if(newarr.length>1){                fn(newarr,1,res);            }else{                res.redirect('/hlist');            }        });    // }});function fn(newarr,index,res) {    con.query('delete from context where id=?',[newarr[index]],function (err,rul,fiels) {        if(err)throw err;        if(newarr.length>(index+1)){            fn(newarr,index+1,res);        }else{            res.redirect('/hlist');        }    });}module.exports = router;